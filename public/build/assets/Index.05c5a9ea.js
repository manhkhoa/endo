import{q as ne,s as j,r as _,o as n,h as k,j as i,a,d as r,e as d,k as J,m as W,u as X,A as Y,E as Z,t as Q,f as ee,v as D,x as w,n as K,p as H,c as B,i as I,w as L,g as le,y as re,z as de,F as ue}from"./app.ca5d1c04.js";import{d as G}from"./vuedraggable.umd.b6f8a751.js";const ce={pageItems:[],items:[],all:!1,global:!1};function me(q){return!!q.pageItems.every(c=>q.items.includes(c))}function pe(q,c){return c.pageItems.forEach(p=>{q&&!c.items.includes(p)?c.items.push(p):q||c.items.splice(c.items.indexOf(p),1)}),c.items}const fe={class:"grid grid-cols-1"},_e={class:"col-span-1"},ge={name:"UtilityTodoListForm"},he=Object.assign(ge,{emits:["completed"],setup(q,{emit:c}){const p={name:""},h="utility/todo/",f=ne(h),x=j({...p}),g=u=>{c("completed",u)};return(u,C)=>{const A=_("BaseInput"),l=_("FormAction");return n(),k(l,{"no-card":!0,"init-url":h,"init-form":p,action:"addList",form:x,"keep-adding":!1,"after-submit":g},{default:i(()=>[a("div",fe,[a("div",_e,[r(A,{type:"text",modelValue:x.name,"onUpdate:modelValue":C[0]||(C[0]=T=>x.name=T),name:"name",placeholder:u.$trans("utility.todo.list.props.name"),error:d(f).name,"onUpdate:error":C[1]||(C[1]=T=>d(f).name=T)},null,8,["modelValue","placeholder","error"])])])]),_:1},8,["form"])}}}),ye={class:"flex-shrink-0 flex flex-col p-3 w-80 bg-gray-100 dark:bg-neutral-800 rounded-md h-[calc(100vh_-_250px)]"},ve={class:"flex-1 min-h-0 scroller-thin-y scroller-hidden"},ke={key:0,class:"mt-2 p-2 rounded-md border-dashed border-2 border-gray-400 dark:border-gray-500 text-gray-400 dark:text-gray-500 text-sm"},be={class:"p-3 space-y-2"},$e=["onClick"],we={class:"text-xs flex justify-between"},Ce={class:"space-x-2"},Ae={class:"cursor-move"},Ue=a("i",{class:"fas fa-arrows-up-down-left-right text-gray-400 dark:text-gray-900"},null,-1),Ie=[Ue],Be={key:0,class:"font-medium"},Le=a("i",{class:"far fa-clock"},null,-1),qe={key:1},xe=a("i",{class:"far fa-clock"},null,-1),Ve={class:"space-x-2"},De={key:0},Te=["onClick"],Fe={key:1},Se=["onClick"],Oe={key:2},Re=["onClick"],Pe={key:3},je=["onClick"],ze={name:"UtilityTodoListBoardView"},Ee=Object.assign(ze,{props:{todos:{type:Object,default(){return{data:[]}}},preRequisites:{type:Object,default:()=>({})}},emits:["newListAdded"],setup(q,{emit:c}){const p=q;J();const h=W(),f=X(),x=Y("emitter"),g=j({lists:[],emptyList:[]}),u=()=>{g.lists=[];let t=[{name:"Uncategorized",uuid:"uncategorized",items:[]}];p.preRequisites.todoLists.forEach(m=>{t.push({name:m.name,uuid:m.uuid,items:[]})}),p.todos.data.forEach(m=>{var U;if((U=m.list)!=null&&U.uuid){let y=t.find($=>$.name==m.list.name);y?y.items.push(m):t.push({name:m.list.name,uuid:m.list.uuid,items:[m]})}else t.find(y=>y.name==="Uncategorized").items.push(m)}),t.find(m=>m.name==="Uncategorized").items.length===0&&(t=t.filter(m=>m.name!=="Uncategorized")),g.lists=t},C=t=>{let m=g.lists.map(U=>U.uuid);f.dispatch("utility/todo/reorderList",{uuids:m}).then(U=>{}).catch(U=>{})},A=t=>{var U,y;let m=0;if(t.removed&&(m=t.removed.oldIndex),t.added){let $=t.added.element.uuid,e=(U=t.added.element.list)==null?void 0:U.uuid,s=null,v=[];g.lists.forEach(S=>{S.items.find(O=>O.uuid===$)&&(s=S.uuid,v=S.items.map(O=>O.uuid))}),f.dispatch("utility/todo/moveList",{uuid:$,listUuid:s,itemUuids:v}).then(S=>{}).catch(S=>{e===void 0&&(e="uncategorized"),g.lists.find(R=>R.uuid===e).items.splice(m,0,t.added.element);let F=g.lists.find(R=>R.uuid===s);F.items=F.items.filter(R=>R.uuid!==$)})}if(t.moved){t.moved.element.uuid;let $=((y=t.moved.element.list)==null?void 0:y.uuid)||"uncategorized",s=g.lists.find(v=>v.uuid===$).items.map(v=>v.uuid);f.dispatch("utility/todo/reorderItems",{uuids:s}).then(v=>{}).catch(v=>{})}},l=t=>{c("newListAdded",t.option),g.lists.push({name:t.option.name,uuid:t.option.uuid,items:[]})},T=async t=>{x.emit("actionItem",{uuid:t.uuid,action:"status",confirmation:!0})},z=async t=>{x.emit("actionItem",{uuid:t.uuid,action:"archive",confirmation:!0})},b=async t=>{x.emit("actionItem",{uuid:t.uuid,action:"unarchive",confirmation:!0})};return Z(()=>p.todos,t=>{u()},{deep:!0}),Q(()=>{u()}),(t,m)=>{const U=_("KanBanView"),y=ee("tooltip");return n(),k(U,{"add-list":!!d(H)("utility:config")},{addListTitle:i(()=>[D(w(t.$trans("global.add",{attribute:t.$trans("utility.todo.list.list")})),1)]),addListForm:i(()=>[r(he,{onCompleted:l})]),default:i(()=>[r(d(G),{class:"flex space-x-2",list:g.lists,onChange:C,"item-key":"uuid",disabled:!d(H)("utility:config")},{item:i(({element:$})=>[a("div",ye,[a("h3",{class:K(["pb-2 text-sm font-medium text-gray-900 dark:text-gray-300",{"cursor-move":!!d(H)("utility:config")}])},w($.name),3),a("div",ve,[r(d(G),{class:"mt-2 space-y-3",list:$.items,group:"items",onChange:A,"item-key":"uuid"},{header:i(()=>[$.items.length===0?(n(),B("div",ke,w(t.$trans("utility.todo.list.info_empty")),1)):I("",!0)]),item:i(({element:e})=>[a("div",{class:K(["bg-white dark:bg-dark-body text-gray-700 dark:text-gray-400 rounded-md shadow-sm border-2",{"border-success":e.completedAt,"border-danger":e.isOverdue,"border-warning":e.isDueToday,"border-gray-400":!e.completedAt&&!e.isOverdue&&!e.isDueToday}])},[a("div",be,[a("p",{class:"text-sm cursor-pointer",onClick:s=>d(h).push({name:"UtilityTodoShow",params:{uuid:e.uuid}})},w(e.title),9,$e),a("div",we,[a("div",Ce,[L((n(),B("span",Ae,Ie)),[[y,t.$trans("general.move")]]),e.isOverdue?L((n(),B("span",Be,[Le,D(" "+w(e.due),1)])),[[y,e.overdueDaysDisplay]]):(n(),B("span",qe,[xe,D(" "+w(e.due),1)]))]),a("span",Ve,[e.completedAt?L((n(),B("span",De,[a("i",{class:"fas fa-times-circle fa-lg cursor-pointer text-danger",onClick:s=>T(e)},null,8,Te)])),[[y,t.$trans("utility.todo.mark_as_incomplete")]]):L((n(),B("span",Fe,[a("i",{class:"fas fa-check-circle fa-lg cursor-pointer text-success",onClick:s=>T(e)},null,8,Se)])),[[y,t.$trans("utility.todo.mark_as_complete")]]),e.completedAt&&!e.isArchived?L((n(),B("span",Oe,[a("i",{class:"fas fa-box-archive cursor-pointer text-gray-400",onClick:s=>z(e)},null,8,Re)])),[[y,t.$trans("general.archive")]]):I("",!0),e.isArchived?L((n(),B("span",Pe,[a("i",{class:"fas fa-box-open cursor-pointer text-gray-400",onClick:s=>b(e)},null,8,je)])),[[y,t.$trans("general.unarchive")]]):I("",!0)])])])],2)]),_:2},1032,["list"])])])]),_:1},8,["list","disabled"])]),_:1},8,["add-list"])}}}),He={class:"grid grid-cols-3 gap-6"},Me={class:"col-span-3 sm:col-span-1"},Ne={class:"col-span-3 sm:col-span-1"},Ke={class:"col-span-3 sm:col-span-1"},Ge={class:"col-span-3 sm:col-span-1"},Je={__name:"Filter",props:{preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(q,{emit:c}){const p=q,h={search:"",startDate:"",endDate:"",status:"",isArchived:!1},f=j({...h}),x=j({statuses:p.preRequisites.statuses});return(g,u)=>{const C=_("BaseInput"),A=_("DatePicker"),l=_("BaseSelect"),T=_("BaseSwitch"),z=_("FilterForm");return n(),k(z,{"init-form":h,form:f,onHide:u[5]||(u[5]=b=>c("hide"))},{default:i(()=>[a("div",He,[a("div",Me,[r(C,{type:"text",modelValue:f.search,"onUpdate:modelValue":u[0]||(u[0]=b=>f.search=b),name:"search",label:g.$trans("general.search")},null,8,["modelValue","label"])]),a("div",Ne,[r(A,{start:f.startDate,"onUpdate:start":u[1]||(u[1]=b=>f.startDate=b),end:f.endDate,"onUpdate:end":u[2]||(u[2]=b=>f.endDate=b),name:"dateBetween",as:"range",label:g.$trans("general.date_between")},null,8,["start","end","label"])]),a("div",Ke,[r(l,{modelValue:f.status,"onUpdate:modelValue":u[3]||(u[3]=b=>f.status=b),name:"status",label:g.$trans("utility.todo.status"),options:x.statuses},null,8,["modelValue","label","options"])]),a("div",Ge,[r(T,{vertical:"",modelValue:f.isArchived,"onUpdate:modelValue":u[4]||(u[4]=b=>f.isArchived=b),name:"isArchived",label:g.$trans("general.archived")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},We=a("i",{class:"fas fa-cog"},null,-1),Xe=a("i",{class:"fas fa-list"},null,-1),Ye=a("i",{class:"fas fa-table-columns"},null,-1),Ze={class:"space-x-1"},Qe={key:0},et=["onClick"],tt={key:1},st=["onClick"],it={key:2},at=["onClick"],ot={key:3},nt=["onClick"],lt={name:"UilityTodoList"},ut=Object.assign(lt,{setup(q){const c=J(),p=W();X();const h=Y("emitter");let f=[];H("task:export")&&(f=["print","pdf","excel"]);const x=le("utility.todoView"),g="utility/todo/",u=j({statuses:[],todoLists:[]}),C=re(!1),A=j({data:[]}),l=j({...ce}),T=e=>{Object.assign(A,e),l.pageItems=A.data.map(s=>s.uuid)},z=async e=>{h.emit("actionItem",{uuid:e.uuid,action:"status",confirmation:!0})},b=async e=>{h.emit("actionItem",{uuid:e.uuid,action:"archive",confirmation:!0})},t=async e=>{h.emit("actionItem",{uuid:e.uuid,action:"unarchive",confirmation:!0})},m=e=>{Object.assign(u,e)},U=e=>{e=="delete"&&h.emit("deleteItems",{global:l.global,uuids:l.items})},y=e=>{u.todoLists.push(e)},$=()=>{c.name=="UtilityTodoList"&&(!c.query.view||c.query.view===void 0)&&p.push({query:{view:x.value}})};return Z(()=>[l.items,l.pageItems,c.query.view],([e,s,v],[S,O,F])=>{v!=F?($(),v&&F!==void 0&&h.emit("listItems")):l.all=me(l)}),Q(()=>{$()}),(e,s)=>{const v=_("BaseButton"),S=_("PageHeaderAction"),O=_("PageHeader"),F=_("ParentTransition"),R=_("BaseArrayCheckbox"),te=_("BaseCheckbox"),P=_("DataCell"),N=_("BaseBadge"),M=_("FloatingMenuItem"),se=_("FloatingMenu"),ie=_("DataRow"),ae=_("DataTable"),oe=_("ListItem"),E=ee("tooltip");return n(),k(oe,{"init-url":g,"pre-requisites":!0,onSetPreRequisites:m,onSetItems:T},{header:i(()=>[r(O,{title:e.$trans("utility.todo.todo")},{default:i(()=>[r(S,{url:"utility/todos/",name:"UtilityTodo",title:e.$trans("utility.todo.todo"),actions:["create","filter"],"bulk-actions":[{name:"delete",label:e.$trans("general.delete"),icon:"fas fa-trash"}],"show-bulk-action":l.items.length>0||l.global,"dropdown-actions":d(f),onToggleFilter:s[3]||(s[3]=o=>C.value=!C.value),onOnBulkAction:U},{after:i(()=>[d(H)("utility:config")?(n(),k(v,{key:0,design:"white",onClick:s[0]||(s[0]=o=>d(p).push({name:"UtilityConfig"}))},{default:i(()=>[We]),_:1})):I("",!0),d(c).query.view!="list"?L((n(),k(v,{key:1,design:"white",onClick:s[1]||(s[1]=o=>d(p).push({query:{view:"list"}}))},{default:i(()=>[Xe]),_:1})),[[E,e.$trans("global._view",{attribute:e.$trans("general.views.list")})]]):I("",!0),d(c).query.view!="board"?L((n(),k(v,{key:2,design:"white",onClick:s[2]||(s[2]=o=>d(p).push({query:{view:"board"}}))},{default:i(()=>[Ye]),_:1})),[[E,e.$trans("global._view",{attribute:e.$trans("general.views.board")})]]):I("",!0)]),_:1},8,["title","bulk-actions","show-bulk-action","dropdown-actions"])]),_:1},8,["title"])]),filter:i(()=>[r(F,{appear:"",visibility:C.value},{default:i(()=>[r(Je,{onRefresh:s[4]||(s[4]=o=>d(h).emit("listItems")),"pre-requisites":u,onHide:s[5]||(s[5]=o=>C.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"])]),default:i(()=>[d(c).query.view=="list"?(n(),k(F,{key:0,appear:"",visibility:!0},{default:i(()=>[r(ae,{onToggleSelectAll:s[9]||(s[9]=o=>l.items=d(pe)(o,l)),onToggleGlobalSelect:s[10]||(s[10]=o=>l.global=!l.global),selected:l,header:A.headers,meta:A.meta,module:"utility.todo",onRefresh:s[11]||(s[11]=o=>d(h).emit("listItems"))},{actionButton:i(()=>[r(v,{onClick:s[8]||(s[8]=o=>d(p).push({name:"UtilityTodoCreate"}))},{default:i(()=>[D(w(e.$trans("global.add",{attribute:e.$trans("utility.todo.todo")})),1)]),_:1})]),default:i(()=>[(n(!0),B(ue,null,de(A.data,o=>(n(),k(ie,{key:o.uuid},{default:i(()=>[r(P,{name:"selectAll"},{default:i(()=>[l.global?I("",!0):(n(),k(R,{key:0,items:l.items,"onUpdate:items":s[6]||(s[6]=V=>l.items=V),value:o.uuid},null,8,["items","value"])),l.global?(n(),k(te,{key:1,modelValue:l.global,"onUpdate:modelValue":s[7]||(s[7]=V=>l.global=V)},null,8,["modelValue"])):I("",!0)]),_:2},1024),r(P,{name:"title"},{default:i(()=>[D(w(o.title),1)]),_:2},1024),r(P,{name:"due"},{default:i(()=>[D(w(o.due),1)]),_:2},1024),r(P,{name:"status"},{default:i(()=>[o.status?(n(),k(N,{key:0,design:"success",label:e.$trans("utility.todo.completed")},null,8,["label"])):(n(),k(N,{key:1,design:"error",label:e.$trans("utility.todo.incomplete")},null,8,["label"]))]),_:2},1024),r(P,{name:"completedAt"},{default:i(()=>[D(w(o.completedAt),1)]),_:2},1024),r(P,{name:"statusUpdate"},{default:i(()=>[a("span",Ze,[o.completedAt?L((n(),B("span",Qe,[a("i",{class:"fas fa-times-circle fa-lg cursor-pointer text-danger",onClick:V=>z(o)},null,8,et)])),[[E,e.$trans("utility.todo.mark_as_incomplete")]]):L((n(),B("span",tt,[a("i",{class:"fas fa-check-circle fa-lg cursor-pointer text-success",onClick:V=>z(o)},null,8,st)])),[[E,e.$trans("utility.todo.mark_as_complete")]]),o.completedAt&&!o.isArchived?L((n(),B("span",it,[a("i",{class:"fas fa-box-archive cursor-pointer text-gray-400",onClick:V=>b(o)},null,8,at)])),[[E,e.$trans("general.archive")]]):I("",!0),o.isArchived?L((n(),B("span",ot,[a("i",{class:"fas fa-box-open cursor-pointer text-gray-400",onClick:V=>t(o)},null,8,nt)])),[[E,e.$trans("general.unarchive")]]):I("",!0)])]),_:2},1024),r(P,{name:"action"},{default:i(()=>[r(se,null,{default:i(()=>[r(M,{icon:"fas fa-arrow-circle-right",onClick:V=>d(p).push({name:"UtilityTodoShow",params:{uuid:o.uuid}})},{default:i(()=>[D(w(e.$trans("general.show")),1)]),_:2},1032,["onClick"]),r(M,{icon:"fas fa-edit",onClick:V=>d(p).push({name:"UtilityTodoEdit",params:{uuid:o.uuid}})},{default:i(()=>[D(w(e.$trans("general.edit")),1)]),_:2},1032,["onClick"]),r(M,{icon:"fas fa-copy",onClick:V=>d(p).push({name:"UtilityTodoDuplicate",params:{uuid:o.uuid}})},{default:i(()=>[D(w(e.$trans("general.duplicate")),1)]),_:2},1032,["onClick"]),r(M,{icon:"fas fa-trash",onClick:V=>d(h).emit("deleteItem",{uuid:o.uuid})},{default:i(()=>[D(w(e.$trans("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):I("",!0),d(c).query.view=="board"?(n(),k(F,{key:1,appear:"",visibility:!0},{default:i(()=>[A.meta?(n(),k(Ee,{key:0,todos:A,"pre-requisites":u,onNewListAdded:y},null,8,["todos","pre-requisites"])):I("",!0)]),_:1})):I("",!0)]),_:1})}}});export{ut as default};
