import{k as M,q as G,s as U,E as H,r as u,o as C,h as j,j as a,c as B,x as m,d as s,a as D,e as r,I as J,m as K,A as Q,p as W,y as S,t as X,G as Y,F as E,v as f,i as w,z as Z}from"./app.ca5d1c04.js";const x={key:0},ee={key:1},te={class:"grid grid-cols-2 gap-6"},ae={class:"col-span-2"},se={class:"col-span-2 sm:col-span-1"},oe={class:"col-span-2 sm:col-span-1"},ne={class:"col-span-2"},le={name:"TaskChecklistForm"},ie=Object.assign(le,{props:{visibility:{type:Boolean,default:!1},action:{type:String,default:"create"},selectedChecklist:{type:Object,default(){return{}}}},emits:["close","completed"],setup(i,{emit:v}){const y=i;M();const b={title:"",dueDate:"",dueTime:"",description:""},c="task/checklist/",p=G(c),l=U({...b});return H(()=>[y.action,y.selectedChecklist.uuid],o=>{Object.assign(b,y.selectedChecklist),Object.assign(l,J(b))}),(o,e)=>{const h=u("BaseInput"),k=u("DatePicker"),I=u("BaseTextarea"),F=u("FormAction"),O=u("BaseSideover");return C(),j(O,{visibility:i.visibility,onClose:e[11]||(e[11]=g=>v("close"))},{title:a(()=>[i.action=="create"?(C(),B("span",x,m(o.$trans("global.add",{attribute:o.$trans("task.checklist.checklist")})),1)):(C(),B("span",ee,m(o.$trans("global.edit",{attribute:o.$trans("task.checklist.checklist")})),1))]),default:a(()=>{var g;return[s(F,{sideover:"","no-card":"","no-data-fetch":"","cancel-action":"","keep-adding":i.action!="update",action:i.action,"init-url":c,"init-form":b,moduleUuid:(g=i.selectedChecklist)==null?void 0:g.uuid,form:l,onEnd:e[8]||(e[8]=t=>v("close")),onCompleted:e[9]||(e[9]=t=>v("completed")),onCancelled:e[10]||(e[10]=t=>v("close"))},{default:a(()=>[D("div",te,[D("div",ae,[s(h,{type:"text",modelValue:l.title,"onUpdate:modelValue":e[0]||(e[0]=t=>l.title=t),name:"title",label:o.$trans("task.checklist.props.title"),error:r(p).title,"onUpdate:error":e[1]||(e[1]=t=>r(p).title=t),autofocus:""},null,8,["modelValue","label","error"])]),D("div",se,[s(k,{modelValue:l.dueDate,"onUpdate:modelValue":e[2]||(e[2]=t=>l.dueDate=t),name:"dueDate",label:o.$trans("task.checklist.props.due_date"),error:r(p).dueDate,"onUpdate:error":e[3]||(e[3]=t=>r(p).dueDate=t)},null,8,["modelValue","label","error"])]),D("div",oe,[s(k,{modelValue:l.dueTime,"onUpdate:modelValue":e[4]||(e[4]=t=>l.dueTime=t),name:"dueTime",label:o.$trans("task.checklist.props.due_time"),as:"time",error:r(p).dueTime,"onUpdate:error":e[5]||(e[5]=t=>r(p).dueTime=t)},null,8,["modelValue","label","error"])]),D("div",ne,[s(I,{modelValue:l.description,"onUpdate:modelValue":e[6]||(e[6]=t=>l.description=t),name:"description",rows:2,label:o.$trans("task.checklist.props.description"),error:r(p).description,"onUpdate:error":e[7]||(e[7]=t=>r(p).description=t)},null,8,["modelValue","label","error"])])])]),_:1},8,["keep-adding","action","moduleUuid","form"])]}),_:1},8,["visibility"])}}}),de={key:0,class:"fas fa-check-circle text-success"},re={name:"TaskChecklistList"},ce=Object.assign(re,{props:{task:{type:Object,default(){return{}}}},emits:["refresh"],setup(i,{emit:v}){const y=i,b=M();K();const c=Q("emitter");W("task:edit");const p="task/checklist/",l=S("create"),o=S(!1),e=U({}),h=U({uuid:null,title:"",dueDate:"",dueTime:"",description:""}),k=U({}),I=d=>{Object.assign(e,d)},F=d=>{Object.assign(k,{...d}),l.value="update",o.value=!0},O=d=>{Object.assign(k,{...d}),l.value="create",o.value=!0},g=()=>{y.task.hasProgress&&v("refresh")},t=()=>{Object.assign(k,h),g(),c.emit("listItems")},P=()=>{Object.assign(k,h),o.value=!1};return X(async()=>{c.on("addTaskChecklist",()=>{Object.assign(k,h),l.value="create",o.value=!0}),c.on("actionPerformed",()=>{g()})}),Y(()=>{c.all.delete("addTaskChecklist"),c.all.delete("actionPerformed")}),(d,T)=>{const $=u("DataCell"),V=u("FloatingMenuItem"),R=u("FloatingMenu"),L=u("DataRow"),N=u("BaseButton"),q=u("DataTable"),z=u("ListItem");return C(),B(E,null,[s(z,{"init-url":p,uuid:r(b).params.uuid,onSetItems:I},{default:a(()=>[s(q,{header:e.headers,meta:e.meta,module:"task.checklist",onRefresh:T[1]||(T[1]=n=>r(c).emit("listItems"))},{actionButton:a(()=>{var n;return[!i.task.isCompleted&&((n=i.task.permission)==null?void 0:n.manageChecklist)?(C(),j(N,{key:0,onClick:T[0]||(T[0]=_=>o.value=!0)},{default:a(()=>[f(m(d.$trans("global.add",{attribute:d.$trans("task.checklist.checklist")})),1)]),_:1})):w("",!0)]}),default:a(()=>[(C(!0),B(E,null,Z(e.data,n=>(C(),j(L,{key:n.uuid},{default:a(()=>[s($,{name:"title"},{default:a(()=>[f(m(n.title),1)]),_:2},1024),s($,{name:"status"},{default:a(()=>[n.isCompleted?(C(),B("i",de)):w("",!0)]),_:2},1024),s($,{name:"due"},{default:a(()=>[f(m(n.due||"-"),1)]),_:2},1024),s($,{name:"completedAt"},{default:a(()=>[f(m(n.completedAtDisplay||"-"),1)]),_:2},1024),s($,{name:"createdAt"},{default:a(()=>[f(m(n.createdAt),1)]),_:2},1024),s($,{name:"action"},{default:a(()=>{var _;return[!i.task.isCompleted&&((_=i.task.permission)==null?void 0:_.manageChecklist)?(C(),j(R,{key:0},{default:a(()=>[s(V,{icon:"fas fa-edit",onClick:A=>F(n)},{default:a(()=>[f(m(d.$trans("general.edit")),1)]),_:2},1032,["onClick"]),s(V,{icon:"fas fa-copy",onClick:A=>O(n)},{default:a(()=>[f(m(d.$trans("general.duplicate")),1)]),_:2},1032,["onClick"]),s(V,{icon:n.isCompleted?"fas fa-times text-danger":"fas fa-check text-success",onClick:A=>r(c).emit("actionItem",{uuid:i.task.uuid,moduleUuid:n.uuid,action:"toggleStatus",confirmation:!0})},{default:a(()=>[f(m(d.$trans("global.mark",{attribute:n.isCompleted?"incomplete":"complete"})),1)]),_:2},1032,["icon","onClick"]),s(V,{icon:"fas fa-trash",onClick:A=>r(c).emit("deleteItem",{uuid:i.task.uuid,moduleUuid:n.uuid})},{default:a(()=>[f(m(d.$trans("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):w("",!0)]}),_:2},1024)]),_:2},1024))),128))]),_:1},8,["header","meta"])]),_:1},8,["uuid"]),s(ie,{action:l.value,visibility:o.value,"selected-checklist":k,onCompleted:t,onClose:P},null,8,["action","visibility","selected-checklist"])],64)}}});export{ce as default};
